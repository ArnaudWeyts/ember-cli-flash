{"version":3,"file":"object.js","sources":["../../src/flash/object.js"],"sourcesContent":["import Evented from '@ember/object/evented';\nimport EmberObject, { set } from '@ember/object';\nimport { cancel, later } from '@ember/runloop';\nimport { guidFor } from '../utils/computed';\nimport { isTesting, macroCondition } from '@embroider/macros';\n\n// Disable timeout by default when running tests\nconst defaultDisableTimeout = macroCondition(isTesting()) ? true : false;\n\n// Note:\n// To avoid https://github.com/adopted-ember-addons/ember-cli-flash/issues/341 from happening, this class can't simply be called Object\nexport default class FlashObject extends EmberObject.extend(Evented) {\n  exitTimer = null;\n  exiting = false;\n  isExitable = true;\n  initializedTime = null;\n\n  // testHelperDisableTimeout â€“ Set by `disableTimeout` and `enableTimeout` in test-support.js\n\n  get disableTimeout() {\n    return this.testHelperDisableTimeout ?? defaultDisableTimeout;\n  }\n\n  @(guidFor('message').readOnly())\n  _guid;\n\n  // eslint-disable-next-line ember/classic-decorator-hooks\n  init() {\n    super.init(...arguments);\n\n    if (this.disableTimeout || this.sticky) {\n      return;\n    }\n    this.timerTask();\n    this._setInitializedTime();\n  }\n\n  destroyMessage() {\n    this._cancelTimer();\n    if (this.exitTaskInstance) {\n      cancel(this.exitTaskInstance);\n      this._teardown();\n    } else {\n      this.exitTimerTask();\n    }\n  }\n\n  exitMessage() {\n    if (!this.isExitable) {\n      return;\n    }\n    this.exitTimerTask();\n    this.trigger('didExitMessage');\n  }\n\n  willDestroy() {\n    if (this.onDestroy) {\n      this.onDestroy();\n    }\n\n    this._cancelTimer();\n    this._cancelTimer('exitTaskInstance');\n    super.willDestroy(...arguments);\n  }\n\n  preventExit() {\n    set(this, 'isExitable', false);\n  }\n\n  allowExit() {\n    set(this, 'isExitable', true);\n    this._checkIfShouldExit();\n  }\n\n  timerTask() {\n    if (!this.timeout) {\n      return;\n    }\n    const timerTaskInstance = later(() => {\n      this.exitMessage();\n    }, this.timeout);\n    set(this, 'timerTaskInstance', timerTaskInstance);\n  }\n\n  exitTimerTask() {\n    if (this.isDestroyed) {\n      return;\n    }\n    set(this, 'exiting', true);\n    if (this.extendedTimeout) {\n      let exitTaskInstance = later(() => {\n        this._teardown();\n      }, this.extendedTimeout);\n      set(this, 'exitTaskInstance', exitTaskInstance);\n    } else {\n      this._teardown();\n    }\n  }\n\n  _setInitializedTime() {\n    let currentTime = new Date().getTime();\n    set(this, 'initializedTime', currentTime);\n\n    return this.initializedTime;\n  }\n\n  _getElapsedTime() {\n    let currentTime = new Date().getTime();\n\n    return currentTime - this.initializedTime;\n  }\n\n  _cancelTimer(taskName = 'timerTaskInstance') {\n    if (this[taskName]) {\n      cancel(this[taskName]);\n    }\n  }\n\n  _checkIfShouldExit() {\n    if (this._getElapsedTime() >= this.timeout && !this.sticky) {\n      this._cancelTimer();\n      this.exitMessage();\n    }\n  }\n\n  _teardown() {\n    const queue = this.flashService?.queue;\n    if (queue) {\n      queue.removeObject(this);\n    }\n    this.destroy();\n    this.trigger('didDestroyMessage');\n  }\n}\n"],"names":["defaultDisableTimeout","macroCondition","isTesting","FlashObject","_dec","guidFor","readOnly","_class","EmberObject","extend","Evented","constructor","args","_defineProperty","_initializerDefineProperty","_descriptor","disableTimeout","testHelperDisableTimeout","init","arguments","sticky","timerTask","_setInitializedTime","destroyMessage","_cancelTimer","exitTaskInstance","cancel","_teardown","exitTimerTask","exitMessage","isExitable","trigger","willDestroy","onDestroy","preventExit","set","allowExit","_checkIfShouldExit","timeout","timerTaskInstance","later","isDestroyed","extendedTimeout","currentTime","Date","getTime","initializedTime","_getElapsedTime","taskName","queue","flashService","removeObject","destroy","_applyDecoratedDescriptor","prototype","configurable","enumerable","writable","initializer"],"mappings":"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"}